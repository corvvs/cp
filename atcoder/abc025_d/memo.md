# 問題

https://atcoder.jp/contests/abc025/tasks/abc025_d

5x5のマス目に1..25の整数を1つずつ、以下の条件を守って書き込む方法の数を求めよ:

- 縦または横に連続する3つの整数(`a,b,c`)を取った時、`a < b < c`でも`a > b > c`でもない

ただし、少なくとも5つのマス目にはあらかじめ数字が書いてあり、それに矛盾してはいけない。

# メモ

(ACしたけど怪しい解法)

各行および列の大小関係は、`a > b < c > d < e`(W型)または`a < b > c < d > e`(M型)のどちらかしかない。\
よって、大小関係のみに注目すると、盤面全体の大小関係のパターンは`2^(5+5) = 1024`通りとなる。

さらに、大小関係を有向辺として(小さい要素から大きい要素に辺を張る)盤面を有向グラフとみなすと、このグラフは循環を含んではいけない。\
従ってトポロジカルソート可能でなければならない。\
1024通りのグラフについてトポロジカルソートを試してみると、ソート可能なグラフは366通りしかないことがわかる。\
以後、この366通りのグラフのみ考える。

[徒競走](https://atcoder.jp/contests/abc041/tasks/abc041_d)と同じ要領でトポロジカルソートのパターンを数える。\
実際の盤面は、トポロジカルソートした頂点=マス目に先頭から1..25を書き込むことで生成できる。

[解説](http://abc041.contest.atcoder.jp/data/abc/041/editorial.pdf)の記号を使うと、\
「マス目(頂点)の集合`S`からマス目`v`を取り除く」=「マス目`v`に数字`|S|`を書き込む」とみなせる。\
そこで、`v`を取り除く際に`v`の数字をチェックし、0でも`|S|`でもない場合は`v`を取り除けないことにする。

# 疑問点

- 「頂点数が同じだがグラフとして相異なるDAG`G1,G2`のトポロジカルソートは一致しない」は真か？
  - **→ 偽**
  - `G1`を「頂点数`N`, 辺なし」とした時、`G2`のどのトポロジカルソートも`G1`のトポロジカルソートに含まれる。
- ↑が偽の場合、グラフを本問題のケースのようなものに限定すると真になるか？(これも偽だったら上の解法は嘘ということになるが・・・)
  - **→ 真**
  - 1つの盤面(=validな数字の書き込み方=トポロジカルソート)はただ1つの大小関係(=グラフ)に対応するから。
  - ちなみに単射ではない。
- 「1024通りのグラフについてトポロジカルソートを試してみると、ソート可能なグラフは366通りしかないことがわかる。」→実際にソートしないで計算できないか？