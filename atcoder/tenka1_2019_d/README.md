# 問題

https://atcoder.jp/contests/tenka1-2019/tasks/tenka1_2019_d

`N` 個の整数が与えられます。`i` 個目の整数は `a[i]` です。 \
与えられたすべての整数を赤、緑、青の 3 色のいずれかで塗り、\
以下の条件を満たすようにする方法の個数を`998244353`で割ったあまりを求めてください。

```
赤、緑、青で塗られた整数の総和をそれぞれ R,G,Bとする。
三辺の長さがそれぞれ R,G,B であるような正の面積の三角形が存在する。
```

# [解説](https://img.atcoder.jp/tenka1-2019/editorial.pdf)噛み砕きメモ

## 一言で

補集合を数える

## 前半: 数え上げ対象の補集合を特定する

整数の総和を`S`とすると、満たすべき関係式は(`R >= G, R >= B`として)
- `S = R + G + B`
- `R <= G + B = S - R`
  - -> `2R < S`
- `R > 0, G > 0, B > 0`

可能な全ての手からなる集合を`Z`とする。\
`Z`を以下の部分集合に分割する(MECEでないことに注意):

1. `R >= S/2`
2. `G >= S/2`
3. `B >= S/2`
    - これら3つは共通部分を持つ可能性がある
4. その他: `R < S/2, G < S/2, B < S/2`
    - これは上3つとは共通部分を持たない

4.のケースでは`R,B,G`が全て0より大きくなる:\
仮に`R = 0`とすると`B+G = S`だが、これは`B < S/2, G < S/2 -> B+G < S`と矛盾する。\
従って部分集合4が合法ケースの集合と一致する。\
よって、1,2,3のケースを*重複なく*数えて`#Z = 3^N`から差し引けばよい。\
対称性から1,2,3のケースは全て同数のはずなので、1だけを数えることにする。

## 後半: 補集合を数える

`dp[i][r]: a[0]...a[i]までを使い、R = rとなるような手の数`とする。\
初期値は`dp[0][0] = 1.`\
状態`(i,r)`からの遷移は

- 要素`i`を`R`に入れる -> `dp[i*1][r+a[i]] += dp[i][r]`
- 要素`i`を`G`または`B`に入れる -> `dp[i+1][r] += 2*dp[i][r]`

要素1つあたり2つの遷移があるので、計算量は`O(NS)`となる。

`dp[N][r]: R = rとなるような手の数`となるので、`r >= S/2`を満たすような`dp[N][r]`の総和`X`がすなわち求める個数、、、となるはずだが、\
部分集合1,2,3は互いに共通部分を持つ可能性がある:

- `R = G = S/2 (B = 0)` 
- `G = B = S/2 (R = 0)` 
- `B = R = S/2 (G = 0)` 

`R = 0`は`R >= S/2`により自動的に除かれるので、`R = G(= S/2)`および`R = B(= S/2)`だけを気にすればよい。\
両者は明らかに同数なので、`R = G, B = 0`のケースだけを数えることにする。

これは先のDPとほとんど同じだが、遷移を

- 要素`i`を`R`に入れる -> `dp[i*1][r+a[i]] += dp[i][r]`
- 要素`i`を`G`に入れる -> `dp[i+1][r] += dp[i][r]`

とすることで計算でき、`dp[N][S/2] = Y`が求める値となる(`S`が奇数の場合は`Y = 0`)。

結局、`3^N - 3(X - Y) (mod 998244353)`が答えになる。


# メモ

「三辺の長さがそれぞれ R,G,B であるような正の面積の三角形が存在する」\
= 「最大の数より残り２数の和の方が大きい」

整数を2つのグループR,Xに分ける。\
この時、Rの総和がXの総和より小さくなるようにとる。\
さらに、Xを2つのグループG,Bに分ける。\
この時、GもBもRより小さくなるようにとる。

という分割について、「R,G,Bのうち相異なるものの数」!の和が答え。

分割を1つ1つ数えるのは困難なのでは？

S = R + G + B\
R >= G >= B\
-> 3R >= S\
R < G + B = S - R\
-> 2R < S

S/2 > R >= S/3






















